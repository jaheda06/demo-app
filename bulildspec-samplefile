version: 0.2

phases:
  install:
    runtime-versions:
      python: 3.9
    commands:
      - echo "Ensuring pip is up-to-date..."
      - python -m pip install --upgrade pip  # Upgrade pip
      - echo "Safely uninstalling pytest if it exists..."
      - pip uninstall -y pytest || echo "pytest not installed, skipping uninstall."
      - echo "Installing pytest version 6.2.5..."
      - pip install pytest==6.2.5
      - echo "Installing Python dependencies from requirements.txt..."
      - pip install -r requirements.txt

  pre_build:
    commands:
      - echo "Running pytest to execute tests..."
      - pytest || echo "Tests failed but continuing build."

  build:
    commands:
      - echo "Building the application..."
      - python setup.py build

  post_build:
    commands:
      - echo "Build complete. Uploading requirements.txt to S3..."
      - aws s3 cp requirements.txt s3://buildspec-file/requirements.txt

artifacts:
  files:
    - '**/*'
  discard-paths: yes 
